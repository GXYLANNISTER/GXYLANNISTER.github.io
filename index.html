<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JLPT N2 单词学习</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
  <div class="max-w-3xl mx-auto p-4">
    <h1 class="text-3xl font-bold mb-4 text-center">JLPT N2 单词学习</h1>
    <div class="flex justify-center space-x-4 mb-6">
      <button id="tab-list" class="px-4 py-2 rounded bg-blue-500 text-white">单词列表</button>
      <button id="tab-practice" class="px-4 py-2 rounded bg-gray-200 text-gray-700">练习模式</button>
    </div>

    <div id="list-section">
      <table class="w-full table-auto bg-white rounded shadow">
        <thead>
          <tr class="bg-gray-200 text-left">
            <th class="p-2">单词</th>
            <th class="p-2">读音</th>
            <th class="p-2">意思</th>
          </tr>
        </thead>
        <tbody id="vocab-table"></tbody>
      </table>
    </div>

    <div id="practice-section" class="hidden">
      <div id="practice-start" class="text-center">
        <button id="start-btn" class="px-4 py-2 bg-blue-500 text-white rounded">开始练习</button>
      </div>
      <div id="quiz" class="hidden bg-white p-4 rounded shadow">
        <p id="question" class="text-xl mb-4"></p>
        <div id="options" class="space-y-2"></div>
        <button id="next-btn" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded hidden">下一题</button>
      </div>
      <div id="result" class="hidden text-center">
        <p class="text-xl mb-4">得分：<span id="score"></span>/<span id="total"></span></p>
        <button id="restart-btn" class="px-4 py-2 bg-blue-500 text-white rounded">再来一次</button>
      </div>
    </div>
  </div>

  <script>
  let vocab = [];
  let quizList = [];
  let current = 0;
  let score = 0;

  async function loadVocab() {
    const res = await fetch('n2_vocab.json');
    vocab = await res.json();
    const table = document.getElementById('vocab-table');
    vocab.forEach(item => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td class="p-2 border-b">${item.word}</td><td class="p-2 border-b">${item.reading}</td><td class="p-2 border-b">${item.meaning}</td>`;
      table.appendChild(tr);
    });
  }

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function startPractice() {
    quizList = shuffle([...vocab]).slice(0, 10);
    current = 0;
    score = 0;
    document.getElementById('practice-start').classList.add('hidden');
    document.getElementById('result').classList.add('hidden');
    document.getElementById('quiz').classList.remove('hidden');
    showQuestion();
  }

  function showQuestion() {
    const q = quizList[current];
    document.getElementById('question').textContent = `「${q.meaning}」对应的单词是？`;
    const optionsEl = document.getElementById('options');
    optionsEl.innerHTML = '';
    const options = [q.word];
    while (options.length < 4 && options.length < vocab.length) {
      const rand = vocab[Math.floor(Math.random() * vocab.length)].word;
      if (!options.includes(rand)) options.push(rand);
    }
    shuffle(options).forEach(opt => {
      const btn = document.createElement('button');
      btn.textContent = opt;
      btn.className = 'w-full text-left px-4 py-2 border rounded hover:bg-blue-50';
      btn.onclick = () => selectAnswer(opt === q.word, btn);
      optionsEl.appendChild(btn);
    });
    document.getElementById('next-btn').classList.add('hidden');
  }

  function selectAnswer(correct, btn) {
    if (correct) score++;
    document.getElementById('next-btn').classList.remove('hidden');
    Array.from(document.getElementById('options').children).forEach(b => {
      b.disabled = true;
      if (b.textContent === quizList[current].word) {
        b.classList.add('bg-green-200');
      }
      if (b === btn && !correct) {
        b.classList.add('bg-red-200');
      }
    });
  }

  function nextQuestion() {
    current++;
    if (current < quizList.length) {
      showQuestion();
    } else {
      document.getElementById('quiz').classList.add('hidden');
      document.getElementById('result').classList.remove('hidden');
      document.getElementById('score').textContent = score;
      document.getElementById('total').textContent = quizList.length;
      document.getElementById('practice-start').classList.remove('hidden');
    }
  }

  document.getElementById('tab-list').addEventListener('click', () => {
    document.getElementById('list-section').classList.remove('hidden');
    document.getElementById('practice-section').classList.add('hidden');
    document.getElementById('tab-list').classList.add('bg-blue-500','text-white');
    document.getElementById('tab-practice').classList.remove('bg-blue-500','text-white');
    document.getElementById('tab-practice').classList.add('bg-gray-200','text-gray-700');
  });
  document.getElementById('tab-practice').addEventListener('click', () => {
    document.getElementById('list-section').classList.add('hidden');
    document.getElementById('practice-section').classList.remove('hidden');
    document.getElementById('tab-practice').classList.add('bg-blue-500','text-white');
    document.getElementById('tab-list').classList.remove('bg-blue-500','text-white');
    document.getElementById('tab-list').classList.add('bg-gray-200','text-gray-700');
  });
  document.getElementById('start-btn').addEventListener('click', startPractice);
  document.getElementById('next-btn').addEventListener('click', nextQuestion);
  document.getElementById('restart-btn').addEventListener('click', startPractice);

  loadVocab();
  </script>
</body>
</html>
